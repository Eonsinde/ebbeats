{% extends 'ebbeats/index.html' %}
{% block title %}Ebbeats - Cart{% endblock %}

{% block navlinks %}
    <a href="{% url 'ebbeats:home' %}" class='navlink text-left text-uppercase'><i class='fas fa-home mr-3'></i>Home</a>
    <a href="{% url 'ebbeats:explore' %}" class='navlink text-left text-uppercase'><i class='fas fa-globe mr-3'></i>Explore</a>
    <a href="{% url 'ebbeats:contact' %}" class='navlink text-left text-uppercase'><i class='fas fa-phone-alt mr-3'></i>Contact</a>
    <a href="{% url 'ebbeats:contribute' %}" class='navlink text-left text-uppercase'><i class='fas fa-gem mr-3'></i>Contribute</a>
    <a href="#" class='navlink text-left text-uppercase'><i class='fas fa-question-circle mr-3'></i>FAQs</a>
{% endblock %}

    {% block extrastyles %}
    <style>
        .cart-table{
            width: 100%;
            box-sizing: border-box;
        }

        th{
            background: #343a40;
        }

        tr:nth-child(odd){
            background: transparent;
        }

        tr:nth-child(even){
            background: #343a40;
        }

        th, td{
            padding: 10px 8px;
        }

        .album-link:hover{
            color: #dc3545;
            transition: .3s ease;
        }

        .remove-item-btn{
            background: #dc3545;
                transition: .5s ease-in-out;
            }

        .remove-item-btn:hover{
            color: #ecebeb;
            background: #c02f3e;
        }

        .form-btn{
            background: transparent;
            color: #dc3545;
            padding: 7px 11px;
            border: 1px #dc3545 solid;
            border-radius: 3px;
            transition: .5s ease;
        }

        .form-btn:nth-child(2){
            background: transparent;
            color: #3b9ad4;
            border: 1px #3b9ad4 solid;
        }

        .form-btn:hover{
            color: #eeeeee; 
            background: #dc3545;
            transform: scale(1.02);
            box-shadow: 0 0 10px #000000bc;
        }

        .form-btn:nth-child(2):hover{
            color: #eeeeee; 
            background: #3b9ad4;
            transform: scale(1.02);
            box-shadow: 0 0 10px #000000bc;
        }

        .form-btn:focus-within{
            outline: none;
        }
    </style>
    {% endblock %}

    {% block content %}
    <div class='cart-section-container'>
        <h3 class='cart-welcome-msg text-app pt-4 px-4 m-0'></h3>
        <section class='cart-section p-4 mb-5'>
            {% if cart.items.all.exists %}
            <table class="cart-table text-app">
                <thead>
                    <tr>
                        <th class='text-center' scope="col">#</th>
                        <th scope="col">Name</th>
                        <th scope="col" class='text-center'>Price</th>
                        <th class='text-center'>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ord_item in cart.items.all %}
                    <tr>
                        <input type="hidden" value='{{ ord_item.item.pk }}' id="product-id">
                        <td class='text-center'>{{ forloop.counter }}</td>
                        <td><img src="{{ ord_item.item.album.album_cover.url }}" alt="" style='border-radius: 100%' height="30px" width="35px"><a href="{% url 'ebbeats:album-detail' ord_item.item.album.pk %}" class='ml-3 text-app album-link'>{{ ord_item.item.name }}</a></td>
                        <td class='text-center'>{{ ord_item.item.price }}</td>
                        <td class='text-center'><a href="#" class='text-app remove-item-btn badge' title='remove from cart'>&times;</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class='border-top border-dark p-3 mt-3 text-right'>
                <a href='{% url "ebbeats:explore" %}' class='form-btn'>Continue Shopping</a>
                <a href='{% url "ebbeats:checkout" %}' class='form-btn'>Proceed to checkout</a>
            </div>
            {% else %}
                <h3 class='text-app'>No Item in cart</h3>
            {% endif %}
        </section>
    </div><!-- end of the background container for the form section -->
    {% endblock %}


{% block extrascripts %}
    <script>
        new TypeIt('.cart-welcome-msg', {
                speed: 50,
                waitUntilVisible: true
            })
            .type("Your Cart <i class='fas fa-angle-double-right'>")
            .go();


        // to handle removal of items from the cart of our application
        removeBtns = document.querySelectorAll('.remove-item-btn');
        productsID = document.querySelectorAll('#product-id');

        removeBtns.forEach((btn,index) => {
            btn.addEventListener('click', function(){
                $.get(`/ebbeats/remove-from-cart/${productsID[index].value}/`).done(res => {
                    if (res.message === 'removed'){
                        showAlert('Successfully removed from cart', 'info', 5000, 'fadeIn');
                        btn.parentElement.parentElement.remove();
                    }else if(res.message === 'not_present'){
                        showAlert('Item not in your cart', 'info', 5000, 'fadeIn');
                    }else{
                        showAlert('You hav not place any order', 'info', 5000, 'fadeIn');
                    }
                });
            });
        });
    </script>
{% endblock %}

